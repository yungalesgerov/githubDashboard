function e(e){return e&&'object'==typeof e&&'default'in e?e.default:e}function t(e,t){return t.displayName=e,t}function n(e,t){const n=effector.is.unit(e);let r={};n?r={unit:e}:'@@unitShape'in e?'function'==typeof e['@@unitShape']?r=e['@@unitShape']():y('expect @@unitShape to be a function'):r=e;const o=Array.isArray(r),s=d.useRef({stale:1,justSubscribed:0,scope:t}),[u,c,a,i,l]=d.useMemo((()=>{s.current.stale=1;const e=Array.isArray(r)?[]:{},o=[],u=[],c=[],a=[];for(const s in r){if(!{}.hasOwnProperty.call(r,s))continue;const i=r[s];effector.is.unit(i)||y(`expect useUnit ${n?'argument':`value in key "${s}"`} to be a unit`),effector.is.event(i)||effector.is.effect(i)?(e[s]=t?effector.scopeBind(i,{scope:t}):i,c.push(s),a.push(i)):(e[s]=null,o.push(s),u.push(i))}return[e,o,u,c,a]}),[s,t,...Object.keys(r),...Object.values(r)]),p=d.useRef({value:u,storeKeys:c,eventKeys:i,eventValues:l}),v=d.useCallback((e=>{const n=s.current;return n.justSubscribed=1,effector.createWatch({unit:a,fn:()=>{n.stale||(n.stale=1,e())},scope:t,batch:1})}),[a,t,p,s]),m=d.useCallback((()=>{const e=p.current,r=s.current;let f,d=0;const y=e.value,v=e.storeKeys,m=e.eventKeys,b=e.eventValues,S=t!==r.scope;if(r.stale||r.justSubscribed||S){d=!r.justSubscribed||S,f=o?[...u]:{...u},v.length===c.length&&m.length===i.length||(d=1);for(let e=0;e<c.length;e++){const n=h(a[e],t),r=c[e];d||(d=v.includes(r)?y[r]!==n:1),f[r]=n}for(let e=0;e<i.length;e++){const t=l[e],n=i[e];d||(d=m.includes(n)?b[m.indexOf(n)]!==t:1)}}return d&&(e.value=f),e.storeKeys=c,e.eventKeys=i,e.eventValues=l,r.stale=0,r.justSubscribed=!d,r.scope=t,n?e.value.unit:e.value}),[v,a,l,t,p,s]);return f.useSyncExternalStore(v,m,m)}function r([e,t],n){let r,o,s,u,c=b;t?(r=t,s=e,u=[]):({fn:r,store:s,keys:u,defaultValue:o,updateFilter:c=b}=e),effector.is.store(s)||y('useStoreMap expects a store'),Array.isArray(u)||y('useStoreMap expects an array as keys'),'function'!=typeof r&&y('useStoreMap expects a function');const a=d.useCallback((e=>effector.createWatch({unit:s,fn:e,scope:n})),[s,n]),i=d.useCallback((()=>h(s,n)),[s,n]),l=d.useRef(),f=d.useRef(),v=d.useRef(u);return p.useSyncExternalStoreWithSelector(a,i,i,(e=>{if(l.current!==e||!((e,t)=>{if(!e||!t||e.length!==t.length)return 0;let n=1;for(let r=0;r<e.length;r++)if(e[r]!==t[r]){n=0;break}return n})(v.current,u)){let t=r(e,u);void 0===t&&void 0!==o&&(t=o),l.current=e,v.current=u,void 0!==t&&(f.current=t)}return f.current}),((e,t)=>!c(t,e)))}function o(e,t={},r){const{open:o,close:s,set:u}=n({open:e.open,close:e.close,set:e.set},r),c=d.useMemo((()=>({open:o,close:s,set:u})),[e,o]),a=d.useRef({value:null,count:0});v((()=>(c.open(a.current.value),()=>c.close(a.current.value))),[c]),((e,t)=>{if(e===t)return 1;if('object'==typeof e&&null!==e&&'object'==typeof t&&null!==t){const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return 0;for(let r=0;r<n.length;r++){const o=n[r];if(e[o]!==t[o])return 0}return 1}return 0})(a.current.value,t)||(a.current.value=t,a.current.count+=1),v((()=>{c.set(a.current.value)}),[a.current.count])}function s(e){const t=d.useContext(S);return e&&!t&&y('No scope found, consider adding <Provider> to app root'),t}function u(e,t){return((e,t)=>{m(1,'useStore','useUnit'),effector.is.store(e)||y('expect useStore argument to be a store');const n=d.useCallback((n=>effector.createWatch({unit:e,fn:n,scope:t})),[e,t]),r=d.useCallback((()=>h(e,t)),[e,t]);return f.useSyncExternalStore(n,r,r)})(e,s(null==t?void 0:t.forceScope))}function c(e,n){function r(e){const t=d.useRef(e),r=u(o);v((()=>(c({props:t.current,state:o.getState()}),()=>{a({props:t.current,state:o.getState()})})),[]);const s=n(e,r);return t.current=e,s}let o;g('createComponent','@effector/reflect'),effector.is.store(e)?o=e:'object'==typeof e&&null!==e?o=effector.combine(e):y('shape should be a store or object with stores');let s='Unknown';o&&o.shortName&&(s=o.shortName);const c=effector.createEvent(),a=effector.createEvent();return r.mounted=c,r.unmounted=a,t(`${s}.View`,r)}function a(e,t){const n=t?e:e[0];var r;(e=>{if(!e)throw Error("expect first argument be an object")})(k(r=n)||(e=>'function'==typeof e)(r));let o=n.or;const s=n.and;if(s){const n=t?s:s[0];if(k(n)&&'and'in n){const n=a(s,t);e=n[0],o={...o,...n[1]}}else e=s}return[e,o]}function i(e,t){const n=t&&k(r=t[0])&&(r.and||r.or)?t:[{and:t}];var r;const[[o,s],u]=a(n);let c,i={},l={},f=u;var p;return'string'==typeof o?(l={name:o},k(p=s)&&'sid'in p||(i=s||{})):(e=>k(e)&&('domain'in e||'defaultState'in e||'name'in e))(o)&&(l=o,i=o.defaultState||{},c=o.domain),{hook:e,domain:c,defaultState:i,mainConfig:l,maybeConfig:f}}Object.defineProperty(exports,'__esModule',{value:1});var l=require('react'),effector=require('effector'),f=require('use-sync-external-store/shim/index.js'),p=require('use-sync-external-store/shim/with-selector.js'),d=e(l);const y=e=>{throw Error(e)},v='undefined'!=typeof window?d.useLayoutEffect:d.useEffect,m=(e,t,n)=>{l.useEffect((()=>{e&&console.error(`${t} is deprecated${n?`, prefer ${n} instead`:''}`)}),[e,t,n])},h=(e,t)=>t?t.getState(e):e.getState(),b=(e,t)=>e!==t,S=d.createContext(null),{Provider:x}=S,g=(e,t)=>{console.error(`${e} is deprecated${t?`, use ${t} instead`:''}`)},k=e=>'object'==typeof e&&null!==e,j=(e,t={})=>(k(e)&&(j(e.or,t),(e=>{for(const o in e)r=o,(e=>void 0===e)(n=e[o])||'or'===r||'and'===r||(t[r]=n);var n,r})(e),j(e.and,t)),t);exports.Provider=x,exports.connect=e=>(g('connect','useUnit'),n=>{let r=e;return'function'!=typeof e&&(r=n,n=e),t(`Connect(${r.displayName||r.name||'Unknown'})`,(e=>d.createElement(r,{...e,...u(n)})))}),exports.createComponent=c,exports.createGate=(...e)=>(({domain:e,defaultState:n,hook:r,mainConfig:o,maybeConfig:u})=>{function c(e){return r(c,e,s()),null}const a=j({or:u,and:o}),i=`${e?`${e.compositeName.fullName}/`:''}${a.name||'gate'}`,l=effector.createEvent({name:`${i}.set`,sid:a.sid?`${a.sid}|set`:void 0}),f=effector.createEvent({name:`${i}.open`,sid:a.sid?`${a.sid}|open`:void 0}),p=effector.createEvent({name:`${i}.close`,sid:a.sid?`${a.sid}|close`:void 0}),d=effector.createStore(Boolean(0),{name:`${i}.status`,serialize:'ignore'}).on(f,(()=>Boolean(1))).on(p,(()=>Boolean(0))),y=effector.createStore(n,{name:`${i}.state`,sid:a.sid}).on(l,((e,t)=>t)).on(f,((e,t)=>t)).reset(p);if(e){const{hooks:t}=e;effector.launch({target:[t.store,t.store,t.event,t.event,t.event],params:[d,y,f,p,l]})}return c.open=f,c.close=p,c.status=d,c.state=y,c.set=l,t(`Gate:${i}`,c)})(i(o,e)),exports.createStoreConsumer=e=>(g('createStoreConsumer','useUnit'),c(e,(({children:e},t)=>e(t)))),exports.useEvent=(e,t)=>((e,t)=>{if(m(1,'useEvent','useUnit'),!t)return e;const n=effector.is.unit(e)||'object'!=typeof e?{event:e}:e;return d.useMemo((()=>{if(effector.is.unit(e))return effector.scopeBind(e,{scope:t});const n=Array.isArray(e)?[]:{};for(const r in e)n[r]=effector.scopeBind(e[r],{scope:t});return n}),[t,...Object.keys(n),...Object.values(n)])})(e,s(null==t?void 0:t.forceScope)),exports.useGate=(e,t={},n)=>o(e,t,s(null==n?void 0:n.forceScope)),exports.useList=(e,o,u)=>((e,o,s)=>{let u,c,a,i=[];'object'==typeof o&&null!==o?(o.keys&&(i=o.keys),({fn:u,getKey:c,placeholder:a}=o)):u=o,effector.is.store(e)||y('expect useList first argument to be a store'),'function'!=typeof u&&y("expect useList's renderItem to be a function"),Array.isArray(i)||y("expect useList's keys to be an array");const l=d.useMemo((()=>{const n=t(`${e.shortName||'Unknown'}.Item`,(t=>{const{index:n,keys:o,keyVal:u,value:c}=t;if(f.current[1])return f.current[0](c,u);const a=r([{store:e,keys:[n,...o],fn:(e,t)=>e[t[0]]}],s);return f.current[0](a,n)}));return d.memo(n)}),[e,s,!!c]),f=d.useRef([u,c]);f.current=[u,c];const p=d.useMemo((()=>i),i);if(c){const t=n(e,s);return 0===t.length&&a?a:t.map((e=>{const t=f.current[1](e);return d.createElement(l,{keyVal:t,key:t,keys:p,value:e})}))}{const t=r([{store:e,keys:[e],fn:e=>e.length}],s);return 0===t&&a?a:Array.from({length:t},((e,t)=>d.createElement(l,{index:t,key:t,keys:p})))}})(e,o,s(null==u?void 0:u.forceScope)),exports.useProvidedScope=()=>s()||null,exports.useStore=u,exports.useStoreMap=(e,t)=>r([e,t],s(null==e?void 0:e.forceScope)),exports.useUnit=(e,t)=>n(e,s(null==t?void 0:t.forceScope));
//# sourceMappingURL=effector-react.cjs.js.map
