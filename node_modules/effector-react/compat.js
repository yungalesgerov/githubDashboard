'use strict';function e(e){return e&&'object'==typeof e&&'default'in e?e.default:e}function t(e,t){return t.displayName=e,t}function n(e,t){var n=v.is.unit(e),r={};n?r={unit:e}:'@@unitShape'in e?'function'==typeof e['@@unitShape']?r=e['@@unitShape']():m('expect @@unitShape to be a function'):r=e;var u=Array.isArray(r),o=y.useRef({stale:1,justSubscribed:0,scope:t}),a=y.useMemo((function(){o.current.stale=1;var e=Array.isArray(r)?[]:{},u=[],a=[],s=[],c=[];for(var i in r)if({}.hasOwnProperty.call(r,i)){var f=r[i];v.is.unit(f)||m("expect useUnit "+(n?'argument':"value in key \""+i+"\"")+" to be a unit"),v.is.event(f)||v.is.effect(f)?(e[i]=t?v.scopeBind(f,{scope:t}):f,s.push(i),c.push(f)):(e[i]=null,u.push(i),a.push(f))}return[e,u,a,s,c]}),[o,t].concat(Object.keys(r),Object.values(r))),s=a[0],c=a[1],i=a[2],f=a[3],l=a[4],d=y.useRef({value:s,storeKeys:c,eventKeys:f,eventValues:l}),b=y.useCallback((function(e){var n=o.current;return n.justSubscribed=1,v.createWatch({unit:i,fn:function(){n.stale||(n.stale=1,e())},scope:t,batch:1})}),[i,t,d,o]),h=y.useCallback((function(){var e,r=d.current,a=o.current,v=0,p=r.value,y=r.storeKeys,m=r.eventKeys,b=r.eventValues,h=t!==a.scope;if(a.stale||a.justSubscribed||h){v=!a.justSubscribed||h,e=u?[].concat(s):Object.assign({},s),y.length===c.length&&m.length===f.length||(v=1);for(var g=0;g<c.length;g++){var x=S(i[g],t),k=c[g];v||(v=y.includes(k)?p[k]!==x:1),e[k]=x}for(var j=0;j<f.length;j++){var E=l[j],C=f[j];v||(v=m.includes(C)?b[m.indexOf(C)]!==E:1)}}return v&&(r.value=e),r.storeKeys=c,r.eventKeys=f,r.eventValues=l,a.stale=0,a.justSubscribed=!v,a.scope=t,n?r.value.unit:r.value}),[b,i,l,t,d,o]);return p.useSyncExternalStore(b,h,h)}function r(e,t){var n,r,u,o,a=e[0],s=e[1],c=g;if(s)n=s,u=a,o=[];else{n=a.fn,u=a.store,o=a.keys,r=a.defaultValue;var i=a.updateFilter;c=void 0===i?g:i}v.is.store(u)||m('useStoreMap expects a store'),Array.isArray(o)||m('useStoreMap expects an array as keys'),'function'!=typeof n&&m('useStoreMap expects a function');var f=y.useCallback((function(e){return v.createWatch({unit:u,fn:e,scope:t})}),[u,t]),l=y.useCallback((function(){return S(u,t)}),[u,t]),p=y.useRef(),b=y.useRef(),h=y.useRef(o);return d.useSyncExternalStoreWithSelector(f,l,l,(function(e){if(p.current!==e||!function(e,t){if(!e||!t||e.length!==t.length)return 0;for(var n=1,r=0;r<e.length;r++)if(e[r]!==t[r]){n=0;break}return n}(h.current,o)){var t=n(e,o);void 0===t&&void 0!==r&&(t=r),p.current=e,h.current=o,void 0!==t&&(b.current=t)}return b.current}),(function(e,t){return!c(t,e)}))}function u(e,t,r){void 0===t&&(t={});var u=n({open:e.open,close:e.close,set:e.set},r),o=u.open,a=u.close,s=u.set,c=y.useMemo((function(){return{open:o,close:a,set:s}}),[e,o]),i=y.useRef({value:null,count:0});b((function(){return c.open(i.current.value),function(){return c.close(i.current.value)}}),[c]),function(e,t){if(e===t)return 1;if('object'==typeof e&&null!==e&&'object'==typeof t&&null!==t){var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return 0;for(var u=0;u<n.length;u++){var o=n[u];if(e[o]!==t[o])return 0}return 1}return 0}(i.current.value,t)||(i.current.value=t,i.current.count+=1),b((function(){c.set(i.current.value)}),[i.current.count])}function o(e){var t=y.useContext(x);return e&&!t&&m('No scope found, consider adding <Provider> to app root'),t}function a(e,t){return function(e,t){h(1,'useStore','useUnit'),v.is.store(e)||m('expect useStore argument to be a store');var n=y.useCallback((function(n){return v.createWatch({unit:e,fn:n,scope:t})}),[e,t]),r=y.useCallback((function(){return S(e,t)}),[e,t]);return p.useSyncExternalStore(n,r,r)}(e,o(null==t?void 0:t.forceScope))}function s(e,n){function r(e){var t=y.useRef(e),r=a(u);b((function(){return s({props:t.current,state:u.getState()}),function(){c({props:t.current,state:u.getState()})}}),[]);var o=n(e,r);return t.current=e,o}var u;k('createComponent','@effector/reflect'),v.is.store(e)?u=e:'object'==typeof e&&null!==e?u=v.combine(e):m('shape should be a store or object with stores');var o='Unknown';u&&u.shortName&&(o=u.shortName);var s=v.createEvent(),c=v.createEvent();return r.mounted=s,r.unmounted=c,t(o+".View",r)}function c(e,t){var n,r=t?e:e[0];(function(e){if(!e)throw Error('expect first argument be an object')})(j(n=r)||function(e){return'function'==typeof e}(n));var u=r.or,o=r.and;if(o){var a=t?o:o[0];if(j(a)&&'and'in a){var s=c(o,t);e=s[0],u=Object.assign({},u,s[1])}else e=o}return[e,u]}function i(e){function n(e){return a(n,e,o()),null}var r=e.domain,u=e.defaultState,a=e.hook,s=E({or:e.maybeConfig,and:e.mainConfig}),c=(r?r.compositeName.fullName+"/":'')+(s.name||'gate'),i=v.createEvent({name:c+".set",sid:s.sid?s.sid+"|set":void 0}),f=v.createEvent({name:c+".open",sid:s.sid?s.sid+"|open":void 0}),l=v.createEvent({name:c+".close",sid:s.sid?s.sid+"|close":void 0}),p=v.createStore(Boolean(0),{name:c+".status",serialize:'ignore'}).on(f,(function(){return Boolean(1)})).on(l,(function(){return Boolean(0)})),d=v.createStore(u,{name:c+".state",sid:s.sid}).on(i,(function(e,t){return t})).on(f,(function(e,t){return t})).reset(l);if(r){var y=r.hooks;v.launch({target:[y.store,y.store,y.event,y.event,y.event],params:[p,d,f,l,i]})}return n.open=f,n.close=l,n.status=p,n.state=d,n.set=i,t("Gate:"+c,n)}function f(e,t){var n,r,u,o=c(t&&j(n=t[0])&&(n.and||n.or)?t:[{and:t}]),a=o[0],s=a[0],i=a[1],f={},l={},v=o[1];return'string'==typeof s?(l={name:s},j(u=i)&&'sid'in u||(f=i||{})):function(e){return j(e)&&('domain'in e||'defaultState'in e||'name'in e)}(s)&&(l=s,f=s.defaultState||{},r=s.domain),{hook:e,domain:r,defaultState:f,mainConfig:l,maybeConfig:v}}Object.defineProperty(exports,'__esModule',{value:1});var l=require('react'),v=require('effector/compat'),p=require('use-sync-external-store/shim/index.js'),d=require('use-sync-external-store/shim/with-selector.js'),y=e(l),m=function(e){throw Error(e)},b='undefined'!=typeof window?y.useLayoutEffect:y.useEffect,h=function(e,t,n){l.useEffect((function(){e&&console.error(t+" is deprecated"+(n?", prefer "+n+" instead":''))}),[e,t,n])},S=function(e,t){return t?t.getState(e):e.getState()},g=function(e,t){return e!==t},x=y.createContext(null),k=function(e,t){console.error(e+" is deprecated"+(t?", use "+t+" instead":''))},j=function(e){return'object'==typeof e&&null!==e},E=function e(t,n){return void 0===n&&(n={}),j(t)&&(e(t.or,n),function(e){for(var t in e)u=t,function(e){return void 0===e}(r=e[t])||'or'===u||'and'===u||(n[u]=r);var r,u}(t),e(t.and,n)),n};exports.Provider=x.Provider,exports.connect=function(e){return k('connect','useUnit'),function(n){var r=e;return'function'!=typeof e&&(r=n,n=e),t("Connect("+(r.displayName||r.name||'Unknown')+")",(function(e){return y.createElement(r,Object.assign({},e,a(n)))}))}},exports.createComponent=s,exports.createGate=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i(f(u,t))},exports.createStoreConsumer=function(e){return k('createStoreConsumer','useUnit'),s(e,(function(e,t){return(0,e.children)(t)}))},exports.useEvent=function(e,t){return function(e,t){if(h(1,'useEvent','useUnit'),!t)return e;var n=v.is.unit(e)||'object'!=typeof e?{event:e}:e;return y.useMemo((function(){if(v.is.unit(e))return v.scopeBind(e,{scope:t});var n=Array.isArray(e)?[]:{};for(var r in e)n[r]=v.scopeBind(e[r],{scope:t});return n}),[t].concat(Object.keys(n),Object.values(n)))}(e,o(null==t?void 0:t.forceScope))},exports.useGate=function(e,t,n){return void 0===t&&(t={}),u(e,t,o(null==n?void 0:n.forceScope))},exports.useList=function(e,u,a){return function(e,u,o){var a,s,c,i=[];'object'==typeof u&&null!==u?(u.keys&&(i=u.keys),a=u.fn,s=u.getKey,c=u.placeholder):a=u,v.is.store(e)||m('expect useList first argument to be a store'),'function'!=typeof a&&m("expect useList's renderItem to be a function"),Array.isArray(i)||m("expect useList's keys to be an array");var f=y.useMemo((function(){var n=t((e.shortName||'Unknown')+".Item",(function(t){var n=t.index,u=t.keys;if(l.current[1])return l.current[0](t.value,t.keyVal);var a=r([{store:e,keys:[n].concat(u),fn:function(e,t){return e[t[0]]}}],o);return l.current[0](a,n)}));return y.memo(n)}),[e,o,!!s]),l=y.useRef([a,s]);l.current=[a,s];var p=y.useMemo((function(){return i}),i);if(s){var d=n(e,o);return 0===d.length&&c?c:d.map((function(e){var t=l.current[1](e);return y.createElement(f,{keyVal:t,key:t,keys:p,value:e})}))}var b=r([{store:e,keys:[e],fn:function(e){return e.length}}],o);return 0===b&&c?c:Array.from({length:b},(function(e,t){return y.createElement(f,{index:t,key:t,keys:p})}))}(e,u,o(null==a?void 0:a.forceScope))},exports.useProvidedScope=function(){return o()||null},exports.useStore=a,exports.useStoreMap=function(e,t){return r([e,t],o(null==e?void 0:e.forceScope))},exports.useUnit=function(e,t){return n(e,o(null==t?void 0:t.forceScope))};
//# sourceMappingURL=compat.js.map
