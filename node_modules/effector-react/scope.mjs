function e(e,t){return t.displayName=e,t}function t(e,t){const n=k.unit(e);let r={};n?r={unit:e}:'@@unitShape'in e?'function'==typeof e['@@unitShape']?r=e['@@unitShape']():C('expect @@unitShape to be a function'):r=e;const o=Array.isArray(r),s=m.useRef({stale:1,justSubscribed:0,scope:t}),[u,c,a,i,l]=m.useMemo((()=>{s.current.stale=1;const e=Array.isArray(r)?[]:{},o=[],u=[],c=[],a=[];for(const s in r){if(!{}.hasOwnProperty.call(r,s))continue;const i=r[s];k.unit(i)||C(`expect useUnit ${n?'argument':`value in key "${s}"`} to be a unit`),k.event(i)||k.effect(i)?(e[s]=t?S(i,{scope:t}):i,c.push(s),a.push(i)):(e[s]=null,o.push(s),u.push(i))}return[e,o,u,c,a]}),[s,t,...Object.keys(r),...Object.values(r)]),f=m.useRef({value:u,storeKeys:c,eventKeys:i,eventValues:l}),d=m.useCallback((e=>{const n=s.current;return n.justSubscribed=1,g({unit:a,fn:()=>{n.stale||(n.stale=1,e())},scope:t,batch:1})}),[a,t,f,s]),p=m.useCallback((()=>{const e=f.current,r=s.current;let d,p=0;const y=e.value,m=e.storeKeys,v=e.eventKeys,b=e.eventValues,h=t!==r.scope;if(r.stale||r.justSubscribed||h){p=!r.justSubscribed||h,d=o?[...u]:{...u},m.length===c.length&&v.length===i.length||(p=1);for(let e=0;e<c.length;e++){const n=O(a[e],t),r=c[e];p||(p=m.includes(r)?y[r]!==n:1),d[r]=n}for(let e=0;e<i.length;e++){const t=l[e],n=i[e];p||(p=v.includes(n)?b[v.indexOf(n)]!==t:1)}}return p&&(e.value=d),e.storeKeys=c,e.eventKeys=i,e.eventValues=l,r.stale=0,r.justSubscribed=!p,r.scope=t,n?e.value.unit:e.value}),[d,a,l,t,f,s]);return w(d,p,p)}function n([e,t],n){let r,o,s,u,c=U;t?(r=t,s=e,u=[]):({fn:r,store:s,keys:u,defaultValue:o,updateFilter:c=U}=e),k.store(s)||C('useStoreMap expects a store'),Array.isArray(u)||C('useStoreMap expects an array as keys'),'function'!=typeof r&&C('useStoreMap expects a function');const a=m.useCallback((e=>g({unit:s,fn:e,scope:n})),[s,n]),i=m.useCallback((()=>O(s,n)),[s,n]),l=m.useRef(),f=m.useRef(),d=m.useRef(u);return M(a,i,i,(e=>{if(l.current!==e||!((e,t)=>{if(!e||!t||e.length!==t.length)return 0;let n=1;for(let r=0;r<e.length;r++)if(e[r]!==t[r]){n=0;break}return n})(d.current,u)){let t=r(e,u);void 0===t&&void 0!==o&&(t=o),l.current=e,d.current=u,void 0!==t&&(f.current=t)}return f.current}),((e,t)=>!c(t,e)))}function r(e,n={},r){const{open:o,close:s,set:u}=t({open:e.open,close:e.close,set:e.set},r),c=m.useMemo((()=>({open:o,close:s,set:u})),[e,o]),a=m.useRef({value:null,count:0});A((()=>(c.open(a.current.value),()=>c.close(a.current.value))),[c]),((e,t)=>{if(e===t)return 1;if('object'==typeof e&&null!==e&&'object'==typeof t&&null!==t){const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return 0;for(let r=0;r<n.length;r++){const o=n[r];if(e[o]!==t[o])return 0}return 1}return 0})(a.current.value,n)||(a.current.value=n,a.current.count+=1),A((()=>{c.set(a.current.value)}),[a.current.count])}function o(e){const t=m.useContext(K);return e&&!t&&C('No scope found, consider adding <Provider> to app root'),t}function s(e,t){const n=t?e:e[0];var r;(e=>{if(!e)throw Error("expect first argument be an object")})(N(r=n)||(e=>'function'==typeof e)(r));let o=n.or;const u=n.and;if(u){const n=t?u:u[0];if(N(n)&&'and'in n){const n=s(u,t);e=n[0],o={...o,...n[1]}}else e=u}return[e,o]}function u(e,t){const n=t&&N(r=t[0])&&(r.and||r.or)?t:[{and:t}];var r;const[[o,u],c]=s(n);let a,i={},l={},f=c;var d;return'string'==typeof o?(l={name:o},N(d=u)&&'sid'in d||(i=u||{})):(e=>N(e)&&('domain'in e||'defaultState'in e||'name'in e))(o)&&(l=o,i=o.defaultState||{},a=o.domain),{hook:e,domain:a,defaultState:i,mainConfig:l,maybeConfig:f}}function c(...t){return(({domain:t,defaultState:n,hook:r,mainConfig:s,maybeConfig:u})=>{function c(e){return r(c,e,o()),null}const a=V({or:u,and:s}),i=`${t?`${t.compositeName.fullName}/`:''}${a.name||'gate'}`,l=$({name:`${i}.set`,sid:a.sid?`${a.sid}|set`:void 0}),f=$({name:`${i}.open`,sid:a.sid?`${a.sid}|open`:void 0}),d=$({name:`${i}.close`,sid:a.sid?`${a.sid}|close`:void 0}),p=x(Boolean(0),{name:`${i}.status`,serialize:'ignore'}).on(f,(()=>Boolean(1))).on(d,(()=>Boolean(0))),y=x(n,{name:`${i}.state`,sid:a.sid}).on(l,((e,t)=>t)).on(f,((e,t)=>t)).reset(d);if(t){const{hooks:e}=t;j({target:[e.store,e.store,e.event,e.event,e.event],params:[p,y,f,d,l]})}return c.open=f,c.close=d,c.status=p,c.state=y,c.set=l,e(`Gate:${i}`,c)})(u(r,t))}function a(e){return L('createStoreConsumer','useUnit'),t=>{const n=i(e);return t.children(n)}}function i(e){return((e,t)=>{E(1,'useStore','useUnit'),k.store(e)||C('expect useStore argument to be a store');const n=m.useCallback((n=>g({unit:e,fn:n,scope:t})),[e,t]),r=m.useCallback((()=>O(e,t)),[e,t]);return w(n,r,r)})(e,o(1))}function l(e){return t(e,o(1))}function f(r,s){return((r,o,s)=>{let u,c,a,i=[];'object'==typeof o&&null!==o?(o.keys&&(i=o.keys),({fn:u,getKey:c,placeholder:a}=o)):u=o,k.store(r)||C('expect useList first argument to be a store'),'function'!=typeof u&&C("expect useList's renderItem to be a function"),Array.isArray(i)||C("expect useList's keys to be an array");const l=m.useMemo((()=>{const t=e(`${r.shortName||'Unknown'}.Item`,(e=>{const{index:t,keys:o,keyVal:u,value:c}=e;if(f.current[1])return f.current[0](c,u);const a=n([{store:r,keys:[t,...o],fn:(e,t)=>e[t[0]]}],s);return f.current[0](a,t)}));return m.memo(t)}),[r,s,!!c]),f=m.useRef([u,c]);f.current=[u,c];const d=m.useMemo((()=>i),i);if(c){const e=t(r,s);return 0===e.length&&a?a:e.map((e=>{const t=f.current[1](e);return m.createElement(l,{keyVal:t,key:t,keys:d,value:e})}))}{const e=n([{store:r,keys:[r],fn:e=>e.length}],s);return 0===e&&a?a:Array.from({length:e},((e,t)=>m.createElement(l,{index:t,key:t,keys:d})))}})(r,s,o(1))}function d(e,t){const r=o(1);return n(t?[e,t]:[{store:e.store,keys:e.keys,fn:e.fn,updateFilter:e.updateFilter}],r)}function p(e){return((e,t)=>{if(E(1,'useEvent','useUnit'),!t)return e;const n=k.unit(e)||'object'!=typeof e?{event:e}:e;return m.useMemo((()=>{if(k.unit(e))return S(e,{scope:t});const n=Array.isArray(e)?[]:{};for(const r in e)n[r]=S(e[r],{scope:t});return n}),[t,...Object.keys(n),...Object.values(n)])})(e,o(1))}function y(e,t={}){return r(e,t,o(1))}import m,{useEffect as v}from'react';import b from'use-sync-external-store/shim/with-selector.js';import h from'use-sync-external-store/shim/index.js';import{is as k,createWatch as g,scopeBind as S,createEvent as $,createStore as x,launch as j}from'effector/effector.mjs';const C=e=>{throw Error(e)},A='undefined'!=typeof window?m.useLayoutEffect:m.useEffect,E=(e,t,n)=>{v((()=>{e&&console.error(`${t} is deprecated${n?`, prefer ${n} instead`:''}`)}),[e,t,n])},{useSyncExternalStore:w}=h,{useSyncExternalStoreWithSelector:M}=b,O=(e,t)=>t?t.getState(e):e.getState(),U=(e,t)=>e!==t,K=m.createContext(null),{Provider:R}=K,N=e=>'object'==typeof e&&null!==e,V=(e,t={})=>(N(e)&&(V(e.or,t),(e=>{for(const o in e)r=o,(e=>void 0===e)(n=e[o])||'or'===r||'and'===r||(t[r]=n);var n,r})(e),V(e.and,t)),t),L=(e,t)=>{console.error(`${e} is deprecated${t?`, use ${t} instead`:''}`)},B=()=>C('not implemented'),F=t=>(L('connect','useUnit'),n=>{let r=t;return'function'!=typeof t&&(r=n,n=t),e(`Connect(${r.displayName||r.name||'Unknown'})`,(e=>m.createElement(r,{...e,...i(n)})))});console.error('`effector-react/scope` is deprecated. Use `effector-react` directly instead');export{R as Provider,F as connect,B as createComponent,c as createGate,a as createStoreConsumer,p as useEvent,y as useGate,f as useList,i as useStore,d as useStoreMap,l as useUnit};
//# sourceMappingURL=scope.mjs.map
