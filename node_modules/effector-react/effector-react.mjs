function e(e,t){return t.displayName=e,t}function t(e,t){const n=S.unit(e);let r={};n?r={unit:e}:'@@unitShape'in e?'function'==typeof e['@@unitShape']?r=e['@@unitShape']():E('expect @@unitShape to be a function'):r=e;const o=Array.isArray(r),s=b.useRef({stale:1,justSubscribed:0,scope:t}),[u,c,a,i,l]=b.useMemo((()=>{s.current.stale=1;const e=Array.isArray(r)?[]:{},o=[],u=[],c=[],a=[];for(const s in r){if(!{}.hasOwnProperty.call(r,s))continue;const i=r[s];S.unit(i)||E(`expect useUnit ${n?'argument':`value in key "${s}"`} to be a unit`),S.event(i)||S.effect(i)?(e[s]=t?k(i,{scope:t}):i,c.push(s),a.push(i)):(e[s]=null,o.push(s),u.push(i))}return[e,o,u,c,a]}),[s,t,...Object.keys(r),...Object.values(r)]),f=b.useRef({value:u,storeKeys:c,eventKeys:i,eventValues:l}),p=b.useCallback((e=>{const n=s.current;return n.justSubscribed=1,g({unit:a,fn:()=>{n.stale||(n.stale=1,e())},scope:t,batch:1})}),[a,t,f,s]),d=b.useCallback((()=>{const e=f.current,r=s.current;let p,d=0;const y=e.value,m=e.storeKeys,v=e.eventKeys,b=e.eventValues,h=t!==r.scope;if(r.stale||r.justSubscribed||h){d=!r.justSubscribed||h,p=o?[...u]:{...u},m.length===c.length&&v.length===i.length||(d=1);for(let e=0;e<c.length;e++){const n=U(a[e],t),r=c[e];d||(d=m.includes(r)?y[r]!==n:1),p[r]=n}for(let e=0;e<i.length;e++){const t=l[e],n=i[e];d||(d=v.includes(n)?b[v.indexOf(n)]!==t:1)}}return d&&(e.value=p),e.storeKeys=c,e.eventKeys=i,e.eventValues=l,r.stale=0,r.justSubscribed=!d,r.scope=t,n?e.value.unit:e.value}),[p,a,l,t,f,s]);return O(p,d,d)}function n([e,t],n){let r,o,s,u,c=K;t?(r=t,s=e,u=[]):({fn:r,store:s,keys:u,defaultValue:o,updateFilter:c=K}=e),S.store(s)||E('useStoreMap expects a store'),Array.isArray(u)||E('useStoreMap expects an array as keys'),'function'!=typeof r&&E('useStoreMap expects a function');const a=b.useCallback((e=>g({unit:s,fn:e,scope:n})),[s,n]),i=b.useCallback((()=>U(s,n)),[s,n]),l=b.useRef(),f=b.useRef(),p=b.useRef(u);return R(a,i,i,(e=>{if(l.current!==e||!((e,t)=>{if(!e||!t||e.length!==t.length)return 0;let n=1;for(let r=0;r<e.length;r++)if(e[r]!==t[r]){n=0;break}return n})(p.current,u)){let t=r(e,u);void 0===t&&void 0!==o&&(t=o),l.current=e,p.current=u,void 0!==t&&(f.current=t)}return f.current}),((e,t)=>!c(t,e)))}function r(e,n={},r){const{open:o,close:s,set:u}=t({open:e.open,close:e.close,set:e.set},r),c=b.useMemo((()=>({open:o,close:s,set:u})),[e,o]),a=b.useRef({value:null,count:0});M((()=>(c.open(a.current.value),()=>c.close(a.current.value))),[c]),((e,t)=>{if(e===t)return 1;if('object'==typeof e&&null!==e&&'object'==typeof t&&null!==t){const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return 0;for(let r=0;r<n.length;r++){const o=n[r];if(e[o]!==t[o])return 0}return 1}return 0})(a.current.value,n)||(a.current.value=n,a.current.count+=1),M((()=>{c.set(a.current.value)}),[a.current.count])}function o(e){const t=b.useContext(V);return e&&!t&&E('No scope found, consider adding <Provider> to app root'),t}function s(e,t){return((e,t)=>{if(N(1,'useEvent','useUnit'),!t)return e;const n=S.unit(e)||'object'!=typeof e?{event:e}:e;return b.useMemo((()=>{if(S.unit(e))return k(e,{scope:t});const n=Array.isArray(e)?[]:{};for(const r in e)n[r]=k(e[r],{scope:t});return n}),[t,...Object.keys(n),...Object.values(n)])})(e,o(null==t?void 0:t.forceScope))}function u(e,t){return((e,t)=>{N(1,'useStore','useUnit'),S.store(e)||E('expect useStore argument to be a store');const n=b.useCallback((n=>g({unit:e,fn:n,scope:t})),[e,t]),r=b.useCallback((()=>U(e,t)),[e,t]);return O(n,r,r)})(e,o(null==t?void 0:t.forceScope))}function c(e,n){return t(e,o(null==n?void 0:n.forceScope))}function a(e,t){return n([e,t],o(null==e?void 0:e.forceScope))}function i(r,s,u){return((r,o,s)=>{let u,c,a,i=[];'object'==typeof o&&null!==o?(o.keys&&(i=o.keys),({fn:u,getKey:c,placeholder:a}=o)):u=o,S.store(r)||E('expect useList first argument to be a store'),'function'!=typeof u&&E("expect useList's renderItem to be a function"),Array.isArray(i)||E("expect useList's keys to be an array");const l=b.useMemo((()=>{const t=e(`${r.shortName||'Unknown'}.Item`,(e=>{const{index:t,keys:o,keyVal:u,value:c}=e;if(f.current[1])return f.current[0](c,u);const a=n([{store:r,keys:[t,...o],fn:(e,t)=>e[t[0]]}],s);return f.current[0](a,t)}));return b.memo(t)}),[r,s,!!c]),f=b.useRef([u,c]);f.current=[u,c];const p=b.useMemo((()=>i),i);if(c){const e=t(r,s);return 0===e.length&&a?a:e.map((e=>{const t=f.current[1](e);return b.createElement(l,{keyVal:t,key:t,keys:p,value:e})}))}{const e=n([{store:r,keys:[r],fn:e=>e.length}],s);return 0===e&&a?a:Array.from({length:e},((e,t)=>b.createElement(l,{index:t,key:t,keys:p})))}})(r,s,o(null==u?void 0:u.forceScope))}function l(e,t={},n){return r(e,t,o(null==n?void 0:n.forceScope))}function f(){return o()||null}function p(t,n){function r(e){const t=b.useRef(e),r=u(o);M((()=>(c({props:t.current,state:o.getState()}),()=>{a({props:t.current,state:o.getState()})})),[]);const s=n(e,r);return t.current=e,s}let o;B('createComponent','@effector/reflect'),S.store(t)?o=t:'object'==typeof t&&null!==t?o=$(t):E('shape should be a store or object with stores');let s='Unknown';o&&o.shortName&&(s=o.shortName);const c=j(),a=j();return r.mounted=c,r.unmounted=a,e(`${s}.View`,r)}function d(e){return B('createStoreConsumer','useUnit'),p(e,(({children:e},t)=>e(t)))}function y(e,t){const n=t?e:e[0];var r;(e=>{if(!e)throw Error("expect first argument be an object")})(I(r=n)||(e=>'function'==typeof e)(r));let o=n.or;const s=n.and;if(s){const n=t?s:s[0];if(I(n)&&'and'in n){const n=y(s,t);e=n[0],o={...o,...n[1]}}else e=s}return[e,o]}function m(e,t){const n=t&&I(r=t[0])&&(r.and||r.or)?t:[{and:t}];var r;const[[o,s],u]=y(n);let c,a={},i={},l=u;var f;return'string'==typeof o?(i={name:o},I(f=s)&&'sid'in f||(a=s||{})):(e=>I(e)&&('domain'in e||'defaultState'in e||'name'in e))(o)&&(i=o,a=o.defaultState||{},c=o.domain),{hook:e,domain:c,defaultState:a,mainConfig:i,maybeConfig:l}}function v(...t){return(({domain:t,defaultState:n,hook:r,mainConfig:s,maybeConfig:u})=>{function c(e){return r(c,e,o()),null}const a=z({or:u,and:s}),i=`${t?`${t.compositeName.fullName}/`:''}${a.name||'gate'}`,l=j({name:`${i}.set`,sid:a.sid?`${a.sid}|set`:void 0}),f=j({name:`${i}.open`,sid:a.sid?`${a.sid}|open`:void 0}),p=j({name:`${i}.close`,sid:a.sid?`${a.sid}|close`:void 0}),d=x(Boolean(0),{name:`${i}.status`,serialize:'ignore'}).on(f,(()=>Boolean(1))).on(p,(()=>Boolean(0))),y=x(n,{name:`${i}.state`,sid:a.sid}).on(l,((e,t)=>t)).on(f,((e,t)=>t)).reset(p);if(t){const{hooks:e}=t;C({target:[e.store,e.store,e.event,e.event,e.event],params:[d,y,f,p,l]})}return c.open=f,c.close=p,c.status=d,c.state=y,c.set=l,e(`Gate:${i}`,c)})(m(r,t))}import b,{useEffect as h}from'react';import{is as S,createWatch as g,scopeBind as k,combine as $,createEvent as j,createStore as x,launch as C}from'effector/effector.mjs';import w from'use-sync-external-store/shim/with-selector.js';import A from'use-sync-external-store/shim/index.js';const E=e=>{throw Error(e)},M='undefined'!=typeof window?b.useLayoutEffect:b.useEffect,N=(e,t,n)=>{h((()=>{e&&console.error(`${t} is deprecated${n?`, prefer ${n} instead`:''}`)}),[e,t,n])},{useSyncExternalStore:O}=A,{useSyncExternalStoreWithSelector:R}=w,U=(e,t)=>t?t.getState(e):e.getState(),K=(e,t)=>e!==t,V=b.createContext(null),{Provider:L}=V,B=(e,t)=>{console.error(`${e} is deprecated${t?`, use ${t} instead`:''}`)},P=t=>(B('connect','useUnit'),n=>{let r=t;return'function'!=typeof t&&(r=n,n=t),e(`Connect(${r.displayName||r.name||'Unknown'})`,(e=>b.createElement(r,{...e,...u(n)})))}),I=e=>'object'==typeof e&&null!==e,z=(e,t={})=>(I(e)&&(z(e.or,t),(e=>{for(const o in e)r=o,(e=>void 0===e)(n=e[o])||'or'===r||'and'===r||(t[r]=n);var n,r})(e),z(e.and,t)),t);export{L as Provider,P as connect,p as createComponent,v as createGate,d as createStoreConsumer,s as useEvent,l as useGate,i as useList,f as useProvidedScope,u as useStore,a as useStoreMap,c as useUnit};
//# sourceMappingURL=effector-react.mjs.map
